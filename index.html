<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tareas del Hogar - Profesional</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: #121521;
      color: #e0e6f0;
      padding: 20px 15px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 5px;
      color: #4fc3f7;
      text-shadow: 0 0 8px #4fc3f7;
    }
    h2 {
      font-weight: 600;
      color: #90caf9;
      margin-bottom: 20px;
      text-align: center;
      user-select: none;
    }
    #taskList, #adminTasks {
      width: 100%;
      max-width: 720px;
      margin: 0 auto 30px auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .task-card {
      background: #1f2738;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(15, 32, 57, 0.6);
      padding: 18px 24px;
      position: relative;
      cursor: default;
      user-select: none;
      opacity: 0;
      animation: fadeInUp 0.45s forwards;
      transition: background-color 0.3s ease, border-left-color 0.3s ease;
      border-left: 6px solid transparent;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .task-card.confirmed {
      border-left-color: #43a047;
      background-color: #263a2e;
      cursor: default;
      user-select: text;
    }
    .task-card.not-confirmed {
      border-left-color: #fbc02d;
      background-color: #3a3c4e;
      cursor: pointer;
      user-select: text;
    }
    .task-desc {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e3f2fd;
      margin-bottom: 6px;
    }
    .task-meta {
      font-size: 0.9rem;
      color: #90a4ae;
      margin-bottom: 10px;
      user-select: text;
    }
    .task-comment {
      font-size: 0.95rem;
      background-color: #2d344a;
      border-radius: 8px;
      padding: 10px 14px;
      color: #cfd8dc;
      white-space: pre-wrap;
      user-select: text;
      box-shadow: inset 0 0 4px #90caf9aa;
      margin-top: 10px;
      max-height: 140px;
      overflow-y: auto;
    }
    .btn-delete, .btn-edit {
      position: absolute;
      top: 14px;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: none;
      font-weight: 700;
      font-size: 18px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      user-drag: none;
    }
    .btn-delete {
      right: 14px;
      background-color: #e53935;
    }
    .btn-delete:hover {
      background-color: #b71c1c;
    }
    .btn-edit {
      right: 56px;
      background-color: #fbc02d;
      color: #212121;
    }
    .btn-edit:hover {
      background-color: #f9a825;
    }
    .input-enviar-container {
      max-width: 720px;
      margin: 0 auto 10px auto;
      background: #1f2738;
      padding: 12px 18px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(15, 32, 57, 0.6);
      display: flex;
      gap: 15px;
      opacity: 0;
      animation: fadeInUp 0.45s forwards;
    }
    .input-enviar-container textarea {
      flex-grow: 1;
      resize: vertical;
      min-height: 44px;
      max-height: 120px;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1.8px solid #4fc3f7;
      background: #2c344b;
      color: #e3f2fd;
      font-size: 1rem;
      font-weight: 500;
      transition: border-color 0.3s ease;
      font-family: 'Inter', sans-serif;
    }
    .input-enviar-container textarea:focus:not(:disabled) {
      border-color: #81d4fa;
      outline: none;
    }
    .input-enviar-container textarea:disabled {
      background: #263a2e;
      color: #a5d6a7;
      cursor: not-allowed;
    }
    .input-enviar-container button {
      background-color: #4fc3f7;
      border: none;
      border-radius: 10px;
      padding: 10px 22px;
      font-size: 1.05rem;
      font-weight: 700;
      color: #121212;
      cursor: pointer;
      box-shadow: 0 6px 14px #29b6f6cc;
      transition: background-color 0.25s ease;
      user-select: none;
    }
    .input-enviar-container button:disabled {
      background-color: #3a6070;
      cursor: default;
      box-shadow: none;
      color: #a0becf;
    }
    .input-enviar-container button:hover:not(:disabled) {
      background-color: #29b6f6;
      box-shadow: 0 8px 20px #29b6f6dd;
    }
    #btnSoyPadre button,
    #btnMostrarLogin,
    #btnLogin,
    #btnCerrarLogin,
    #logoutBtn,
    #btnAgregarTarea {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      padding: 14px 28px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 6px 18px rgba(15, 32, 57, 0.6);
      font-size: 1.1rem;
      margin: 10px 0;
      display: block;
      width: 100%;
      max-width: 280px;
      text-align: center;
      color: #121212;
      background-color: #4fc3f7;
      text-shadow: 0 0 3px #039be5;
    }
    #btnSoyPadre button:hover,
    #btnMostrarLogin:hover,
    #btnLogin:hover,
    #btnAgregarTarea:hover {
      background-color: #29b6f6;
      box-shadow: 0 8px 24px #29b6f6bb;
      color: #0d0d0d;
    }
    #btnCerrarLogin,
    #logoutBtn {
      background-color: #e53935;
      color: white;
      max-width: 280px;
      margin: 10px auto 0 auto;
      text-shadow: none;
    }
    #btnCerrarLogin:hover,
    #logoutBtn:hover {
      background-color: #b71c1c;
      box-shadow: 0 6px 22px #b71c1cbb;
    }
    #loginForm, #adminPanel {
      background: #1f2738;
      padding: 30px 30px 40px 30px;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(15, 32, 57, 0.75);
      width: 100%;
      max-width: 460px;
      margin: 20px auto 40px auto;
      display: none;
      flex-direction: column;
      user-select: none;
    }
    #loginForm input,
    #adminPanel input {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 1.05rem;
      padding: 14px 16px;
      margin: 12px 0;
      border-radius: 12px;
      border: 2px solid #4fc3f7;
      background: #2a344d;
      color: #e3f2fd;
      transition: border-color 0.3s ease;
    }
    #loginForm input:focus,
    #adminPanel input:focus {
      border-color: #81d4fa;
      outline: none;
    }
    #adminPanel input[type="date"] {
      padding-left: 12px;
    }
    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(14px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @media (max-width: 480px) {
      body {
        padding: 15px 10px;
      }
      #loginForm, #adminPanel, #taskList, #adminTasks {
        max-width: 100%;
      }
      .task-card {
        padding: 15px 18px;
      }
      .btn-delete, .btn-edit {
        top: 10px;
        width: 28px;
        height: 28px;
        font-size: 14px;
        right: 12px;
      }
      .btn-edit {
        right: 44px;
      }
      .input-enviar-container button {
        width: 90px;
        padding: 8px 15px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <h1>üìã Tareas del Hogar</h1>
  <div id="taskList" aria-live="polite" aria-label="Lista de tareas"></div>

  <div id="btnSoyPadre" style="text-align:center;">
    <button id="btnMostrarLogin" aria-haspopup="dialog" aria-controls="loginForm" aria-expanded="false">üë§ Soy Padre</button>
  </div>

  <section id="loginForm" role="dialog" aria-modal="true" aria-labelledby="loginTitle" tabindex="-1">
    <h2 id="loginTitle">üîê Iniciar sesi√≥n</h2>
    <input type="text" id="username" placeholder="Usuario" autocomplete="username" aria-label="Usuario" />
    <input type="password" id="password" placeholder="Contrase√±a" autocomplete="current-password" aria-label="Contrase√±a" />
    <button id="btnLogin" aria-describedby="loginTitle">Entrar</button>
    <button id="btnCerrarLogin" aria-label="Cerrar formulario de login">Cerrar</button>
  </section>

  <section id="adminPanel" aria-live="polite" aria-label="Panel de administraci√≥n de tareas" tabindex="-1">
    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Panel de Tareas</h2>
    <input type="text" id="descripcion" placeholder="Descripci√≥n de la tarea" aria-label="Descripci√≥n de la tarea" />
    <input type="text" id="para" placeholder="¬øPara qui√©n es?" aria-label="Para qui√©n es la tarea" />
    <input type="text" id="autor" placeholder="¬øQui√©n la escribi√≥?" aria-label="Autor de la tarea" />
    <input type="date" id="fecha" aria-label="Fecha de la tarea" />
    <button id="btnAgregarTarea" aria-live="polite" aria-atomic="true">Agregar Tarea</button>
    <div id="adminTasks" aria-label="Lista de tareas para administrar"></div>
    <button id="logoutBtn" aria-label="Cerrar sesi√≥n en el panel de administraci√≥n">Salir del Panel</button>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs,
      deleteDoc, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1LqppWSU8KGVNw9xbkFkU1BJLAw0EdUo",
      authDomain: "tareas-542bb.firebaseapp.com",
      projectId: "tareas-542bb",
      storageBucket: "tareas-542bb.appspot.com",
      messagingSenderId: "774046945636",
      appId: "1:774046945636:web:c26868684cfdd9acd66a71",
      measurementId: "G-JF2V8974BX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM elements
    const btnMostrarLogin = document.getElementById("btnMostrarLogin");
    const loginForm = document.getElementById("loginForm");
    const btnCerrarLogin = document.getElementById("btnCerrarLogin");
    const btnLogin = document.getElementById("btnLogin");
    const btnSoyPadre = document.getElementById("btnSoyPadre");
    const adminPanel = document.getElementById("adminPanel");
    const logoutBtn = document.getElementById("logoutBtn");
    const btnAgregarTarea = document.getElementById("btnAgregarTarea");
    const taskList = document.getElementById("taskList");
    const adminTasks = document.getElementById("adminTasks");

    let isAdmin = false;
    let editandoId = null;

    // LocalStorage keys
    const LS_CONFIRMADAS = "tareas_confirmadas";
    const LS_TEXTOS = "tareas_textos";

    // Leer confirmadas de localStorage
    function leerConfirmadas() {
      const data = localStorage.getItem(LS_CONFIRMADAS);
      return data ? JSON.parse(data) : [];
    }

    // Guardar confirmadas en localStorage
    function guardarConfirmadas(arr) {
      localStorage.setItem(LS_CONFIRMADAS, JSON.stringify(arr));
    }

    // Leer textos de localStorage
    function leerTextos() {
      const data = localStorage.getItem(LS_TEXTOS);
      return data ? JSON.parse(data) : {};
    }

    // Guardar textos en localStorage
    function guardarTextos(obj) {
      localStorage.setItem(LS_TEXTOS, JSON.stringify(obj));
    }

    // Alternar confirmaci√≥n de tarea (solo permitir confirmar)
    function toggleConfirmacion(id) {
      let confirmadas = leerConfirmadas();
      if (confirmadas.includes(id)) {
        return true;
      } else {
        confirmadas.push(id);
        guardarConfirmadas(confirmadas);
        return true;
      }
    }

    // Renderizar tareas p√∫blicas
    async function mostrarTareas(target = "taskList", adminMode = false) {
      const container = target === "adminTasks" ? adminTasks : taskList;
      container.innerHTML = "";
      const confirmadas = leerConfirmadas();
      const textosLocal = leerTextos();

      try {
        const querySnapshot = await getDocs(collection(db, "tareas"));
        if (querySnapshot.empty) {
          container.innerHTML = `<p style="text-align:center; color:#666;">No hay tareas a√∫n.</p>`;
          return;
        }
        querySnapshot.forEach(docSnap => {
          const tarea = docSnap.data();
          const id = docSnap.id;
          const confirmado = confirmadas.includes(id);
          const textoExtra = textosLocal[id] || "";

          if (adminMode) {
            // Render admin cards con botones editar/eliminar
            const card = document.createElement("div");
            card.className = "task-card confirmed";
            card.innerHTML = `
              <div class="task-desc">${tarea.descripcion}</div>
              <div class="task-meta">Para: ${tarea.para} | Fecha: ${tarea.fecha} | Autor: ${tarea.autor}</div>
              <div class="task-comment">${textoExtra || "<i>Sin comentarios</i>"}</div>
              <button class="btn-edit" aria-label="Editar tarea">‚úèÔ∏è</button>
              <button class="btn-delete" aria-label="Eliminar tarea">üóëÔ∏è</button>
            `;
            container.appendChild(card);

            // Editar
            card.querySelector(".btn-edit").onclick = () => {
              editandoId = id;
              document.getElementById("descripcion").value = tarea.descripcion;
              document.getElementById("para").value = tarea.para;
              document.getElementById("fecha").value = tarea.fecha;
              document.getElementById("autor").value = tarea.autor;
              document.getElementById("btnAgregarTarea").textContent = "Guardar Cambios";
            };

            // Eliminar
            card.querySelector(".btn-delete").onclick = async () => {
              if (confirm("¬øEliminar esta tarea? Esta acci√≥n no se puede deshacer.")) {
                await deleteDoc(doc(db, "tareas", id));
                mostrarTareas("adminTasks", true);
              }
            };
          } else {
            // Render p√∫blico
            const card = document.createElement("div");
            card.className = confirmado ? "task-card confirmed" : "task-card not-confirmed";
            card.setAttribute("tabindex", "0");
            card.setAttribute("role", "button");
            card.setAttribute("aria-pressed", confirmado.toString());
            card.innerHTML = `
              <div class="task-desc">${tarea.descripcion}</div>
              <div class="task-meta">Para: ${tarea.para} | Fecha: ${tarea.fecha} | Autor: ${tarea.autor}</div>
              <div class="task-comment">${textoExtra || "<i>Sin comentarios</i>"}</div>
            `;
            container.appendChild(card);

            if (!confirmado) {
              card.onclick = () => {
                if (toggleConfirmacion(id)) {
                  card.classList.remove("not-confirmed");
                  card.classList.add("confirmed");
                  card.setAttribute("aria-pressed", "true");
                }
              };
              card.onkeypress = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                  card.click();
                  e.preventDefault();
                }
              };
            }
          }
        });
      } catch (error) {
        container.innerHTML = `<p style="color:#f44336; text-align:center;">Error cargando tareas.</p>`;
        console.error(error);
      }
    }

    // Limpia formulario admin
    function limpiarFormulario() {
      document.getElementById("descripcion").value = "";
      document.getElementById("para").value = "";
      document.getElementById("fecha").value = "";
      document.getElementById("autor").value = "";
      editandoId = null;
      btnAgregarTarea.textContent = "Agregar Tarea";
    }

    btnAgregarTarea.addEventListener("click", async () => {
      const descripcion = document.getElementById("descripcion").value.trim();
      const para = document.getElementById("para").value.trim();
      const fecha = document.getElementById("fecha").value;
      const autor = document.getElementById("autor").value.trim();

      if (!descripcion || !para || !fecha || !autor) {
        alert("Por favor completa todos los campos.");
        return;
      }

      try {
        if (editandoId) {
          // Actualizar tarea
          await updateDoc(doc(db, "tareas", editandoId), {
            descripcion, para, fecha, autor
          });
          editandoId = null;
          btnAgregarTarea.textContent = "Agregar Tarea";
        } else {
          // Agregar tarea nueva
          await addDoc(collection(db, "tareas"), {
            descripcion,
            para,
            fecha,
            autor
          });
        }
        limpiarFormulario();
        mostrarTareas("adminTasks", true);
      } catch (error) {
        alert("Error al guardar la tarea. Int√©ntalo de nuevo.");
        console.error(error);
      }
    });

    btnMostrarLogin.addEventListener("click", () => {
      loginForm.style.display = "flex";
      loginForm.focus();
      btnMostrarLogin.setAttribute("aria-expanded", "true");
      btnSoyPadre.style.display = "none";
    });

    btnCerrarLogin.addEventListener("click", () => {
      loginForm.style.display = "none";
      btnMostrarLogin.setAttribute("aria-expanded", "false");
      if (!isAdmin) btnSoyPadre.style.display = "block";
    });

    btnLogin.addEventListener("click", () => {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (user === "Admin" && pass === "familia2025") {
        isAdmin = true;
        loginForm.style.display = "none";
        adminPanel.style.display = "flex";
        adminPanel.focus();
        mostrarTareas("adminTasks", true);
        btnSoyPadre.style.display = "none";
        limpiarFormulario();
      } else {
        alert("Credenciales incorrectas.");
      }
    });

    logoutBtn.addEventListener("click", () => {
      isAdmin = false;
      adminPanel.style.display = "none";
      btnSoyPadre.style.display = "block";
      mostrarTareas();
      editandoId = null;
      btnAgregarTarea.textContent = "Agregar Tarea";
      limpiarFormulario();
    });

    // Cargar tareas al iniciar (modo p√∫blico)
    mostrarTareas();

  </script>
</body>
</html>
