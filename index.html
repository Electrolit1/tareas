<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tareas del Hogar - Profesional Compacto</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #121521;
      color: #e0e6f0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }
    body > div.wrapper {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    h1 {
      font-weight: 700;
      font-size: 2.2rem;
      margin: 0;
      color: #4fc3f7;
      text-shadow: 0 0 8px #4fc3f7;
      user-select: none;
      text-align: center;
    }
    h2 {
      font-weight: 600;
      color: #90caf9;
      margin: 0 0 12px 0;
      user-select: none;
      text-align: center;
    }
    #taskList, #adminTasks {
      width: 100%;
      max-width: 460px;
      max-height: 320px;
      overflow-y: auto;
      background: #1f2738;
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 6px 18px rgba(15, 32, 57, 0.6);
      display: flex;
      flex-direction: column;
      gap: 10px;
      user-select: none;
    }
    .task-card {
      background: #263544;
      border-radius: 10px;
      padding: 10px 14px;
      box-shadow: 0 4px 12px rgba(15, 32, 57, 0.4);
      border-left: 4px solid transparent;
      font-size: 0.88rem;
      color: #e3f2fd;
      cursor: default;
      white-space: pre-wrap;
      word-wrap: break-word;
      transition: background-color 0.25s, border-color 0.25s;
      position: relative;
    }
    .task-card.confirmed {
      border-left-color: #43a047;
      background-color: #2e4635;
      cursor: default;
    }
    .task-card.not-confirmed {
      border-left-color: #fbc02d;
      background-color: #3a3c4e;
      cursor: pointer;
    }
    .task-card.not-confirmed:hover {
      background-color: #4f5570;
    }
    .task-desc {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .task-meta {
      font-size: 0.78rem;
      color: #90a4ae;
      margin-bottom: 6px;
      user-select: text;
    }
    .task-comment {
      font-size: 0.82rem;
      background-color: #2d344a;
      border-radius: 8px;
      padding: 6px 10px;
      color: #cfd8dc;
      max-height: 100px;
      overflow-y: auto;
      box-shadow: inset 0 0 4px #90caf9aa;
      user-select: text;
    }
    /* Botones peque√±os */
    button {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 8px 18px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 5px 16px rgba(15, 32, 57, 0.6);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
      user-drag: none;
      color: #121212;
      background-color: #4fc3f7;
      text-shadow: 0 0 3px #039be5;
      min-width: 120px;
    }
    button:disabled {
      background-color: #3a6070;
      cursor: default;
      box-shadow: none;
      color: #a0becf;
    }
    button:hover:not(:disabled) {
      background-color: #29b6f6;
      box-shadow: 0 7px 22px #29b6f6bb;
      color: #0d0d0d;
    }
    #btnCerrarLogin, #logoutBtn {
      background-color: #e53935;
      color: white;
      min-width: 120px;
      padding: 7px 16px;
      font-size: 0.85rem;
    }
    #btnCerrarLogin:hover, #logoutBtn:hover {
      background-color: #b71c1c;
      box-shadow: 0 6px 22px #b71c1cbb;
    }
    /* Contenedor inputs */
    #loginForm, #adminPanel {
      width: 100%;
      max-width: 460px;
      background: #1f2738;
      padding: 28px 28px 38px 28px;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(15, 32, 57, 0.75);
      display: none;
      flex-direction: column;
      gap: 14px;
      user-select: none;
    }
    #loginForm input, #adminPanel input {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 1rem;
      padding: 12px 14px;
      border-radius: 10px;
      border: 2px solid #4fc3f7;
      background: #2a344d;
      color: #e3f2fd;
      transition: border-color 0.3s ease;
    }
    #loginForm input:focus, #adminPanel input:focus {
      border-color: #81d4fa;
      outline: none;
    }
    #adminPanel input[type="date"] {
      padding-left: 12px;
    }
    #btnAgregarTarea {
      align-self: flex-start;
      min-width: 140px;
      padding: 10px 20px;
      font-size: 1rem;
    }
    #taskList[aria-live] {
      outline: none;
    }
    #btnSoyPadre {
      width: 100%;
      display: flex;
      justify-content: center;
    }
    #btnSoyPadre button {
      min-width: 140px;
      padding: 9px 20px;
    }
    /* Botones editar y eliminar en admin */
    .btn-delete, .btn-edit {
      position: absolute;
      top: 10px;
      width: 26px;
      height: 26px;
      font-size: 14px;
      border-radius: 50%;
      border: none;
      font-weight: 700;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      user-drag: none;
    }
    .btn-delete {
      right: 12px;
      background-color: #e53935;
    }
    .btn-delete:hover {
      background-color: #b71c1c;
    }
    .btn-edit {
      right: 44px;
      background-color: #fbc02d;
      color: #212121;
    }
    .btn-edit:hover {
      background-color: #f9a825;
    }
    /* Scrollbar personalizado */
    #taskList::-webkit-scrollbar,
    #adminTasks::-webkit-scrollbar,
    .task-comment::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    #taskList::-webkit-scrollbar-thumb,
    #adminTasks::-webkit-scrollbar-thumb,
    .task-comment::-webkit-scrollbar-thumb {
      background-color: #4fc3f7aa;
      border-radius: 6px;
    }
    #taskList::-webkit-scrollbar-track,
    #adminTasks::-webkit-scrollbar-track,
    .task-comment::-webkit-scrollbar-track {
      background-color: #121521;
      border-radius: 6px;
    }
    @media (max-width: 480px) {
      body > div.wrapper {
        max-width: 100%;
      }
      #taskList, #adminTasks, #loginForm, #adminPanel {
        max-width: 100%;
      }
      button, #btnSoyPadre button {
        min-width: 110px;
        font-size: 0.85rem;
        padding: 8px 14px;
      }
      .task-card {
        font-size: 0.82rem;
        padding: 8px 12px;
      }
      .btn-delete, .btn-edit {
        top: 8px;
        width: 24px;
        height: 24px;
        font-size: 13px;
        right: 10px;
      }
      .btn-edit {
        right: 38px;
      }
      #btnAgregarTarea {
        min-width: 120px;
        font-size: 0.9rem;
        padding: 8px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper" role="main" aria-label="Aplicaci√≥n de Tareas del Hogar">
    <h1>üìã Tareas del Hogar</h1>
    <div id="taskList" aria-live="polite" aria-label="Lista de tareas"></div>

    <div id="btnSoyPadre">
      <button id="btnMostrarLogin" aria-haspopup="dialog" aria-controls="loginForm" aria-expanded="false">üë§ Soy Padre</button>
    </div>

    <section id="loginForm" role="dialog" aria-modal="true" aria-labelledby="loginTitle" tabindex="-1">
      <h2 id="loginTitle">üîê Iniciar sesi√≥n</h2>
      <input type="text" id="username" placeholder="Usuario" autocomplete="username" aria-label="Usuario" />
      <input type="password" id="password" placeholder="Contrase√±a" autocomplete="current-password" aria-label="Contrase√±a" />
      <button id="btnLogin" aria-describedby="loginTitle">Entrar</button>
      <button id="btnCerrarLogin" aria-label="Cerrar formulario de login">Cerrar</button>
    </section>

    <section id="adminPanel" aria-live="polite" aria-label="Panel de administraci√≥n de tareas" tabindex="-1">
      <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Panel de Tareas</h2>
      <input type="text" id="descripcion" placeholder="Descripci√≥n de la tarea" aria-label="Descripci√≥n de la tarea" />
      <input type="text" id="para" placeholder="¬øPara qui√©n es?" aria-label="Para qui√©n es la tarea" />
      <input type="text" id="autor" placeholder="¬øQui√©n la escribi√≥?" aria-label="Autor de la tarea" />
      <input type="date" id="fecha" aria-label="Fecha de la tarea" />
      <button id="btnAgregarTarea" aria-live="polite" aria-atomic="true">Agregar Tarea</button>
      <div id="adminTasks" aria-label="Lista de tareas para administrar"></div>
      <button id="logoutBtn" aria-label="Cerrar sesi√≥n en el panel de administraci√≥n">Salir del Panel</button>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs,
      deleteDoc, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1LqppWSU8KGVNw9xbkFkU1BJLAw0EdUo",
      authDomain: "tareas-542bb.firebaseapp.com",
      projectId: "tareas-542bb",
      storageBucket: "tareas-542bb.appspot.com",
      messagingSenderId: "774046945636",
      appId: "1:774046945636:web:c26868684cfdd9acd66a71",
      measurementId: "G-JF2V8974BX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const btnMostrarLogin = document.getElementById("btnMostrarLogin");
    const loginForm = document.getElementById("loginForm");
    const btnCerrarLogin = document.getElementById("btnCerrarLogin");
    const btnLogin = document.getElementById("btnLogin");
    const btnSoyPadre = document.getElementById("btnSoyPadre");
    const adminPanel = document.getElementById("adminPanel");
    const logoutBtn = document.getElementById("logoutBtn");
    const btnAgregarTarea = document.getElementById("btnAgregarTarea");
    const taskList = document.getElementById("taskList");
    const adminTasks = document.getElementById("adminTasks");

    let isAdmin = false;
    let editandoId = null;

    const LS_CONFIRMADAS = "tareas_confirmadas";
    const LS_TEXTOS = "tareas_textos";

    function leerConfirmadas() {
      const data = localStorage.getItem(LS_CONFIRMADAS);
      return data ? JSON.parse(data) : [];
    }

    function guardarConfirmadas(arr) {
      localStorage.setItem(LS_CONFIRMADAS, JSON.stringify(arr));
    }

    function leerTextos() {
      const data = localStorage.getItem(LS_TEXTOS);
      return data ? JSON.parse(data) : {};
    }

    function guardarTextos(obj) {
      localStorage.setItem(LS_TEXTOS, JSON.stringify(obj));
    }

    function toggleConfirmacion(id) {
      let confirmadas = leerConfirmadas();
      if (confirmadas.includes(id)) {
        return true;
      } else {
        confirmadas.push(id);
        guardarConfirmadas(confirmadas);
        return true;
      }
    }

    async function mostrarTareas(target = "taskList", adminMode = false) {
      const container = target === "adminTasks" ? adminTasks : taskList;
      container.innerHTML = "";
      const confirmadas = leerConfirmadas();
      const textosLocal = leerTextos();

      try {
        const querySnapshot = await getDocs(collection(db, "tareas"));
        if (querySnapshot.empty) {
          container.innerHTML = `<p style="text-align:center; color:#666;">No hay tareas a√∫n.</p>`;
          return;
        }
        querySnapshot.forEach(docSnap => {
          const tarea = docSnap.data();
          const id = docSnap.id;
          const confirmado = confirmadas.includes(id);
          const textoExtra = textosLocal[id] || "";

          if (adminMode) {
            const card = document.createElement("div");
            card.className = "task-card confirmed";
            card.innerHTML = `
              <div class="task-desc">${tarea.descripcion}</div>
              <div class="task-meta">Para: ${tarea.para} | Fecha: ${tarea.fecha} | Autor: ${tarea.autor}</div>
              <div class="task-comment">${textoExtra || "<i>Sin comentarios</i>"}</div>
              <button class="btn-edit" aria-label="Editar tarea">‚úèÔ∏è</button>
              <button class="btn-delete" aria-label="Eliminar tarea">üóëÔ∏è</button>
            `;
            container.appendChild(card);

            card.querySelector(".btn-edit").onclick = () => {
              editandoId = id;
              document.getElementById("descripcion").value = tarea.descripcion;
              document.getElementById("para").value = tarea.para;
              document.getElementById("fecha").value = tarea.fecha;
              document.getElementById("autor").value = tarea.autor;
              btnAgregarTarea.textContent = "Guardar Cambios";
            };

            card.querySelector(".btn-delete").onclick = async () => {
              if (confirm("¬øEliminar esta tarea? Esta acci√≥n no se puede deshacer.")) {
                await deleteDoc(doc(db, "tareas", id));
                mostrarTareas("adminTasks", true);
              }
            };
          } else {
            const card = document.createElement("div");
            card.className = confirmado ? "task-card confirmed" : "task-card not-confirmed";
            card.setAttribute("tabindex", "0");
            card.setAttribute("role", "button");
            card.setAttribute("aria-pressed", confirmado.toString());
            card.innerHTML = `
              <div class="task-desc">${tarea.descripcion}</div>
              <div class="task-meta">Para: ${tarea.para} | Fecha: ${tarea.fecha} | Autor: ${tarea.autor}</div>
              <div class="task-comment">${textoExtra || "<i>Sin comentarios</i>"}</div>
            `;
            container.appendChild(card);

            if (!confirmado) {
              card.onclick = () => {
                if (toggleConfirmacion(id)) {
                  card.classList.remove("not-confirmed");
                  card.classList.add("confirmed");
                  card.setAttribute("aria-pressed", "true");
                }
              };
              card.onkeypress = (e) => {
                if (e.key === "Enter" || e.key === " ") {
                  card.click();
                  e.preventDefault();
                }
              };
            }
          }
        });
      } catch (error) {
        container.innerHTML = `<p style="color:#f44336; text-align:center;">Error cargando tareas.</p>`;
        console.error(error);
      }
    }

    function limpiarFormulario() {
      document.getElementById("descripcion").value = "";
      document.getElementById("para").value = "";
      document.getElementById("fecha").value = "";
      document.getElementById("autor").value = "";
      editandoId = null;
      btnAgregarTarea.textContent = "Agregar Tarea";
    }

    btnAgregarTarea.addEventListener("click", async () => {
      const descripcion = document.getElementById("descripcion").value.trim();
      const para = document.getElementById("para").value.trim();
      const fecha = document.getElementById("fecha").value;
      const autor = document.getElementById("autor").value.trim();

      if (!descripcion || !para || !fecha || !autor) {
        alert("Por favor completa todos los campos.");
        return;
      }

      try {
        if (editandoId) {
          await updateDoc(doc(db, "tareas", editandoId), {
            descripcion, para, fecha, autor
          });
          editandoId = null;
          btnAgregarTarea.textContent = "Agregar Tarea";
        } else {
          await addDoc(collection(db, "tareas"), {
            descripcion,
            para,
            fecha,
            autor
          });
        }
        limpiarFormulario();
        mostrarTareas("adminTasks", true);
      } catch (error) {
        alert("Error al guardar la tarea. Int√©ntalo de nuevo.");
        console.error(error);
      }
    });

    btnMostrarLogin.addEventListener("click", () => {
      loginForm.style.display = "flex";
      loginForm.focus();
      btnMostrarLogin.setAttribute("aria-expanded", "true");
      btnSoyPadre.style.display = "none";
    });

    btnCerrarLogin.addEventListener("click", () => {
      loginForm.style.display = "none";
      btnMostrarLogin.setAttribute("aria-expanded", "false");
      if (!isAdmin) btnSoyPadre.style.display = "block";
    });

    btnLogin.addEventListener("click", () => {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (user === "Admin" && pass === "familia2025") {
        isAdmin = true;
        loginForm.style.display = "none";
        adminPanel.style.display = "flex";
        adminPanel.focus();
        mostrarTareas("adminTasks", true);
        btnSoyPadre.style.display = "none";
        limpiarFormulario();
      } else {
        alert("Credenciales incorrectas.");
      }
    });

    logoutBtn.addEventListener("click", () => {
      isAdmin = false;
      adminPanel.style.display = "none";
      btnSoyPadre.style.display = "flex";
      mostrarTareas();
      editandoId = null;
      btnAgregarTarea.textContent = "Agregar Tarea";
      limpiarFormulario();
    });

    // Mostrar tareas en modo p√∫blico al inicio
    mostrarTareas();
  </script>
</body>
</html>
